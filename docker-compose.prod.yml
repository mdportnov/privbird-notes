version: '3'

services:
    backend:
        build: ./backend/
        command: gunicorn -c ./backend/gunicorn.conf.py onetimelinks.wsgi
        expose:
            - "8000"
        env_file:
            - .env.prod
        volumes:
            - .:/app
        depends_on:
            - db
    
    celery:
        build: ./backend/
        command: celery -A onetimelinks worker -B -l INFO
        env_file:
            - .env.prod
        volumes:
            - .:/app
        depends_on:
            - backend
    
    frontend:
        build: ./frontend/
        ports:
            - "8002:80"
        volumes:
            - .:/app
        links:
            - backend:backend
    
    db:
        image: postgres:13
        env_file:
            - .env.prod
        volumes:
            - postgres_data:/var/lib/postgresql/data/
    
    redis:
        image: redis:6-alpine

volumes:
    postgres_data: